<div class="messages-container" (click)="hideAllEmojis()">
    <div class="users-message-container" *ngIf="message.senderId == channelService.currentUserId">
        <div class="message-container">
            <div>
                <img class="user-logo" src="avatar/{{channelService.currentUser?.avatar}}" alt="">
            </div>
            <div class="message-info">
                <div class="user-date-container">
                    <p>{{message.timestamp?.toDate() | date:'HH:mm'}}</p>
                    <span>{{channelService.currentUser?.name}}</span>
                </div>
                <div class="message-content" [ngClass]="{
                'editMessageActive' :editMessageActive, }">
                    <h3 *ngIf="!editMessageActive">{{message.text}}</h3>
                    <mat-form-field *ngIf="editMessageActive" class="example-full-width">
                        <input [(ngModel)]="editMessageText" matInput name="message" value="{{message.text}}">
                        <div class="icons-container">
                            <div>
                                <div (click)="showAllEmojisMessage(index, $event)">
                                    <img [src]="imgReactionInput"
                                        (mouseover)="imgReactionInput = 'add_reaction_color.png'"
                                        (mouseout)="imgReactionInput = 'add reaction.png'">
                                </div>
                            </div>
                            <div class="buttons-cotntainer">
                                <div class="discard-btn-container">
                                    <button (click)="discardEditMessage()">Abbrechen</button>
                                </div>
                                <div class="save-btn-container">
                                    <button (click)="updateMessage()">Speichern</button>
                                </div>
                            </div>
                        </div>
                        <div>
                            <emoji-mart (emojiClick)="addEmoji($event)"></emoji-mart>
                        </div>
                    </mat-form-field>
                </div>
                <div class="message-reaction-container" [class.shifted]="shiftContainer">
                    <div *ngFor="let reaction of message.reactions; let i = index" class="reaction-wrapper"
                        (mouseenter)="showReactionUserName(i)" (mouseleave)="hideReactionUserName()">

                        <div class="reaction-container" *ngIf="i < 20 && mode === 'chat' || showAllMessageReactions">
                            <span>{{ reaction.emoji }}</span>
                            <span>{{reaction.emojiCounter}}</span>
                        </div>
                        <div class="reaction-container" *ngIf="i < 7 && mode === 'thread' || showAllMessageThreadReactions">
                            <span>{{ reaction.emoji }}</span>
                            <span>{{reaction.emojiCounter}}</span>
                        </div>
                        <div class="reaction-user-container" *ngIf="hoveredReactionIndex === i">
                            <div>
                                <p class="emoji">{{reaction.emoji}}</p>
                            </div>
                            <div>
                                <h3>{{ reaction.user }}</h3>
                            </div>
                            <div><span>hat reagiert</span></div>
                        </div>
                    </div>
                    <div class="reaction-container" *ngIf="message?.reactions?.length > 20 && mode === 'chat'">
                        <p *ngIf="!showAllMessageReactions" (click)="showAllReactions()">{{message.reactions.length -
                            20}} weitere</p>
                        <p *ngIf="showAllMessageReactions" (click)="hideAllReactions()">Weniger anzeigen</p>
                    </div>
                    <div class="reaction-container" *ngIf="message?.reactions?.length > 7 && mode === 'thread'">
                        <p *ngIf="!showAllMessageThreadReactions" (click)="showAllReactions()">{{message.reactions.length -
                            7}} weitere</p>
                        <p *ngIf="showAllMessageThreadReactions" (click)="hideAllReactions()">Weniger anzeigen</p>
                    </div>
                    <div (click)="showAllEmojisMessage(index, $event)">
                        <img [src]="imgReaction" (mouseover)="imgReaction='img/add_reaction_color.png'"
                            (mouseout)="imgReaction='img/add_reaction.png'">
                    </div>
                </div>
                <div class="answer-date-container" (click)="chatService.answerOnMessage(message.id, message.text)">
                    <div *ngIf="message.threadCount > 0">
                        <span *ngIf="getLastThreadReplyTime()" class="last-reply-time">Letzte Antwort
                            {{getLastThreadReplyTime() | date:'HH:mm'}}</span>
                        <span>{{message.threadCount}} Antwort{{message.threadCount > 1 ? 'en' : ''}}</span>
                        <p></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="message-hover-options">
        <div [matMenuTriggerFor]="menu" (mouseover)="imgSrcMore = 'img/more_vert_color.png'"
            (mouseout)="imgSrcMore = 'img/more_vert.png'">
            <img [src]="imgSrcMore">
            <div>
                <mat-menu #menu="matMenu">
                    <button mat-menu-item (click)="editMessage()">Nachricht bearbeiten</button>
                </mat-menu>
            </div>
        </div>
        <div *ngIf="mode !== 'thread'" (click)="chatService.answerOnMessage(message.id, message.text)"
            (mouseover)="imgComment='img/comment_color.png'" (mouseout)="imgComment='img/comment.png'">
            <img [src]="imgComment">
        </div>
        <div (click)="showAllEmojisMessage(index, $event)">
            <img [src]="imgReaction" (mouseover)="imgReaction='img/add_reaction_color.png'"
                (mouseout)="imgReaction='img/add_reaction.png'">
        </div>
        <div *ngFor="let emoji of chatService.mostUsedEmojis let i = index">
            <div *ngIf="chatService.mostUsedEmojis.length > 0">
                <p (click)="addMostUsedEmojiMessage(emoji, i)">{{emoji}}</p>
            </div>
        </div>
    </div>
    <div *ngIf="showEmojisMessage" class="emoji-mart-container">
        <emoji-mart (emojiClick)="addEmojiMessage($event)"></emoji-mart>
    </div>
</div>